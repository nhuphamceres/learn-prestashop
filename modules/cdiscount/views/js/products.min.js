var pageInitialized1=false;$(document).ready(function(){if(pageInitialized1){return}pageInitialized1=true;if($.datepicker.initialized!=="undefined"){$("#datepickerTo2").datepicker({prevText:"",nextText:"",dateFormat:"yy-mm-dd"});$("#datepickerFrom2").datepicker({prevText:"",nextText:"",dateFormat:"yy-mm-dd"})}function c(h,j,i){if(window.console){console.log("Ajax Error");console.log(h);console.log(j)}i.show().html($("#serror").val());if(j.output){i.append("<br />"+j.output)}if(j.responseText){i.append("<br />"+j.responseText)}i.append("<hr />");i.append($("#sdebug").val()+":  ");i.append('<form method="'+h.type+'" action="'+h.url+"&debug=1&"+h.data+'" target="_blank"><input type="submit" class="button" id="send-debug" value="Execute in Debug Mode" /></form>')}function e(){$("#send-loader").show();$.ajax({type:"POST",url:$("#create-products-url").val()+"&context_key="+$('input[name="context_key"]').val()+"&action=last_export&callback=?",success:function(h){$("#send-loader").hide();if(window.console){console.log("Loading last exported files... context key:"+$('input[name="context_key"]').val())}$("#create-products-latest").html(h).show();$("#send-products").click(function(){$("#send-loader").show();$.ajax({type:"POST",url:$("#create-products-url").val()+"&context_key="+$('input[name="context_key"]').val()+"&action=products_send&callback=?",success:function(i){$("#send-loader").hide();$("#send-products-result").show().html(i)}})})}})}e();function f(h){if(!h.output&&!h.errors){return(false)}$("#create-products-error").html("");$("#create-products-error").show();$("#create-products-error").append(h.output);$.each(h.errors,function(i,j){$("#create-products-error").append(j+'<hr style="width:30%" />')})}$("#menu-create, #test-button").click(function(){var h=$("#merge-products-url").val();if(window.console){console.log("Merge Products");console.log("URL is :"+h)}$("#create-loader").show();pAjax=new Object();pAjax.type="POST";pAjax.url=h+"&action=export&callback=?";pAjax.data="&context_key="+$('input[name="context_key"]').val();pAjax.data_type="json";if(window.console){console.log(pAjax)}$.ajax({type:pAjax.type,url:pAjax.url,data:pAjax.data,dataType:pAjax.data_type,success:function(i){$("#create-loader").hide();if(window.console){console.log("Success");console.log(i)}if(i.error){f(i)}$("#merge-products-result").show();if(i.count){$("#merge-products-result").html(i.msg+" ("+i.count+")<br />")}else{$("#merge-products-result").html(i.msg)}if(i.output){$("#merge-products-result").append(i.output)}$("#create-products-form").fadeIn("slow");if(!i.error){$("#merge-products").fadeOut("slow")}},error:function(i){$("#create-loader").hide();$("#create-products-form").fadeIn("slow");c(pAjax,i,$("#merge-products-error"))}});return(false)});$("#create-products").click(function(){var h=$("#create-products-url").val();$("#create-products-result").html("").hide();$("#create-products-error").html("").hide();if(window.console){console.log("Create Products");console.log("URL is :"+h)}$("#create-loader").show();pAjax=new Object();pAjax.type="POST";pAjax.url=h+"&action=export&callback=?";pAjax.data=$("#create-products-form").serialize()+"&context_key="+$('input[name="context_key"]').val();pAjax.data_type="json";if(window.console){console.log(pAjax)}$.ajax({type:pAjax.type,url:pAjax.url,data:pAjax.data,dataType:pAjax.data_type,success:function(i){$("#create-loader").hide();if(window.console){console.log("Success");console.log(i)}if(i.error){f(i)}$("#create-products-result").show();$("#create-products-result").html(i.msg+" ("+i.count+")<br />");if(i.output){$("#create-products-result").append(i.output)}if(i.file){$("#create-products-result").append("<ul />");$("#create-products-result").append('<li><a href="'+i.file+'" target="_blank" >'+i.file+"</a></li>");e()}},error:function(i){$("#create-loader").hide();c(pAjax,i,$("#create-products-error"))}});return(false)});function b(h){if(!h.output&&!h.errors){return(false)}$("#csv-products-result").hide();if(h.errors){$("#csv-products-error").show();$("#csv-products-error").append(h.output);$.each(h.errors,function(i,j){$("#csv-products-error").append(j+'<hr style="width:30%" />')})}}$("#csv-products").click(function(){url=$("#csv-products-url").val();$("#csv-products-error").html("").hide();if(window.console){console.log("Create Products");console.log("URL is :"+url)}$("#csv-loader").show();pAjax=new Object();pAjax.type="POST";pAjax.url=url+"&action=export_csv&callback=?";pAjax.data=$("#csv-products-form").serialize()+"&context_key="+$('input[name="context_key"]').val(),pAjax.data_type="json",$.ajax({type:pAjax.type,url:pAjax.url,data:pAjax.data,dataType:pAjax.data_type,success:function(k){$("#csv-loader").hide();if(window.console){console.log("Success");console.log(k)}$("#csv-products-error").html("").hide();b(k);$("#csv-products-result").show();$("#csv-products-result").html(k.msg+" ("+k.count+")<br />");if(k.output){$("#csv-products-result").append(k.output)}if(k.file){var h=k.file.length;if(h==1){$("#csv-products-result").append("<ul />");$("#csv-products-result ul").append('<li><a href="'+k.file[0][1]+'" target="_blank" >1.- '+k.file[0][0]+"</a></li>")}else{if(h>1){$("#csv-products-result").append("<ul />");for(var j=0;j<k.file.length;j++){$("#csv-products-result ul").append('<li><a href="'+k.file[j][1]+'" target="_blank" >'+(j+1)+".- "+k.file[j][0]+"</a></li>")}}}}},error:function(h){$("#csv-loader").hide();c(pAjax,h,$("#csv-products-error"))}});return(false)});$("#update-products").click(function(){url=$("#update-products-url").val();$("#update-products-result").html("").hide();$("#update-products-error").html("").hide();if(window.console){console.log("update Products");console.log("URL is :"+url)}$("#update-loader").show();pAjax=new Object();pAjax.type="POST";pAjax.url=url+"&action=export&callback=?";pAjax.data=$("#update-products-form").serialize()+"&context_key="+$('input[name="context_key"]').val(),pAjax.data_type="json",$.ajax({type:pAjax.type,url:pAjax.url,data:pAjax.data,dataType:pAjax.data_type,success:function(h){$("#update-loader").hide();if(window.console){console.log(h)}if(h.error){if(h.msg){$("#update-products-result").show();$("#update-products-result").html(h.msg)}else{$("#update-products-result").hide()}$("#update-products-error").show();$("#update-products-error").html(h.output);$.each(h.errors,function(i,j){$("#update-products-error").append(j+"<br />")})}else{$("#update-products-error").hide();$("#update-products-result").show();$("#update-products-result").html(h.msg+"<br />");if(h.output.length){$("#update-products-result").append(h.output)}}d()},error:function(h){$("#update-loader").hide();c(pAjax,h,$("#update-products-error"))}});return(false)});$("#purge-replace").click(function(h){if($(this).attr("checked")){$("#purge-warning").fadeIn()}else{$("#purge-warning").fadeOut()}});function a(h){$("#history-report-content").show();$("#history-report-content pre").html("");$("#history-report-content pre").html(h.content)}function g(h){PackageID=parseInt($(h).html());if(!PackageID){return}pAjax=new Object();pAjax.type="GET";pAjax.url=$("#update-products-url").val()+"&context_key="+$('input[name="context_key"]').val()+"&id="+PackageID+"&action=report&callback=?";pAjax.data="";pAjax.dataType="jsonp";$("#history-loader").show();$.ajax({type:pAjax.type,dataType:pAjax.dataType,url:pAjax.url,success:function(j,i,k){$("#history-loader").hide();$("#history-report-content pre").html("");$("#history-report-content").hide();if(j.success){console.log("success");a(j)}else{console.log("no success")}},error:function(j,i,k){$("#history-loader").hide();c(pAjax,j,$("#update-products-error"))}})}function d(){$(".reportid").unbind("click");pAjax=new Object();pAjax.type="GET";pAjax.url=$("#update-products-url").val()+"&context_key="+$('input[name="context_key"]').val()+"&action=history&callback=?";pAjax.data="";if(window.console){console.log(pAjax)}$.ajax({type:pAjax.type,url:pAjax.url,data:pAjax.data,success:function(i,h,j){if(j.status=="204"){$("#update-products-history").html("").hide()}else{$("#update-products-history").html(i).show();$(".reportid").click(function(){g(this)})}},error:function(i,h,j){c(pAjax,i,$("#update-products-error"))}})}d();(function(h){h.fn.enableCheckboxRangeSelection=function(){var j=null;var i=this;i.unbind("click.checkboxrange");i.bind("click.checkboxrange",function(k){if(j!==null&&(k.shiftKey||k.metaKey)){i.slice(Math.min(i.index(j),i.index(k.target)),Math.max(i.index(j),i.index(k.target))+1).attr({checked:k.target.checked?"checked":""})}j=k.target})}})(jQuery);$(".category").enableCheckboxRangeSelection()});